<html>

<head>
  <meta name="viewport" 
        content="width=device-width, 
        initial-scale=1.0, 
        user-scalable=yes" />
  <title>Visual Version Control for Processing</title>
  
  <style>

  </style>
</head>

<body>
<p id="testText"> Loading...</p>
<canvas id="c" width=device-width height=device-height style="border:1px solid #ccc"></canvas>

<script src ="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.3/fabric.min.js"></script>


<script>

var request = 'http://192.168.4.30:8080';

const sendFork = async (url, id) => {
	const response = await fetch(url + '/fork/id' + id);
}

var data = null;
var count = 0;
const requestData = async (url) => {
	const response = await fetch(url+'/versions.json');
	const json = await response.json();
	console.log(json);
	data = json;
	
	
}
async function update(){
	await requestData(request);
	sendFork(request,count);
	setTimeout(update,1000);
	console.log(count);
	if(data != null){
		document.getElementById("testText").innerHTML = data.hello;
	}
	
	count++;
}

update();




  var canvas = new fabric.Canvas('c');
  canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100, id: 1 }));
  canvas.add(new fabric.Circle({ radius: 20, fill: '#f55', top: 100, left: 100 }));
  canvas.add(new fabric.Circle({ radius: 10, fill: '#f55', top: 100, left: 100 }));
  canvas.item(0).hasControls = canvas.item(0).hasBorders = false;

  obj = canvas.getObjects();
  obj.forEach(function(item,i) {
  	item.hasControls = false;
  	item.hasBorders = false;	
  });

  canvas.on({
    'mouse:down': function(e) {
      if (e.target) {
        e.target.opacity = 0.5;
        canvas.renderAll();
      }
    },
    'mouse:up': function(e) {
      if (e.target) {
        e.target.opacity = 1;
        canvas.renderAll();
      }
    },
    'object:moved': function(e) {
      e.target.opacity = 0.5;
    },
    'object:modified': function(e) {
      e.target.opacity = 1;
    }
  });
	  
  </script>
</body>

</html>